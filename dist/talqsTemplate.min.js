/**
 * TalqsTemplate v1.0.0
 * (c) 2017 JinJun He
 * @license MIT
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.TalqsTemplate=n()}(this,function(){"use strict";function e(e){return e.replace($,"").replace(w,",").replace(b,"").replace(I,"").replace(x,"").split(z)}function n(e){return"'"+e.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function a(a,t){function i(e){return f+=e.split(/\n/).length-1,u&&(e=e.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),e&&(e=g[1]+n(e)+g[2]+"\n"),e}function l(n){var a=f;if(c?n=c(n,t):r&&(n=n.replace(/\n/g,function(){return f++,"$line="+f+";"})),0===n.indexOf("=")){var i=d&&!/^=[=#]/.test(n);if(n=n.replace(/^=[=#]?|[\s;]*$/g,""),i){var l=n.replace(/\s*\([^\)]+\)/,"");p[l]||/^(include|print)$/.test(l)||(n="$escape("+n+")")}else n="$string("+n+")";n=g[1]+n+g[2]}return r&&(n="$line="+a+";"+n),y(e(n),function(e){if(e&&!m[e]){var n;n="print"===e?w:"include"===e?b:p[e]?"$utils."+e:v[e]?"$helpers."+e:"$data."+e,I+=e+"="+n+",",m[e]=!0}}),n+"\n"}var r=t.debug,s=t.openTag,o=t.closeTag,c=t.parser,u=t.compress,d=t.escape,f=1,m={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},h="".trim,g=h?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],$=h?"$out+=text;return $out;":"$out.push(text);",w="function(){var text=''.concat.apply('',arguments);"+$+"}",b="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+$+"}",I="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(r?"$line=0,":""),x=g[0],z="return new String("+g[3]+");";y(a.split(s),function(e){e=e.split(o);var n=e[0],a=e[1];1===e.length?x+=i(n):(x+=l(n),a&&(x+=i(a)))});var A=I+x+z;r&&(A="try{"+A+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+n(a)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var _=new Function("$data","$filename",A);return _.prototype=p,_}catch(e){throw e.temp="function anonymous($data,$filename) {"+A+"}",e}}var t=function(e,n){return"string"==typeof n?h(n,{filename:e}):r(e,n)};t.version="3.0.0",t.config=function(e,n){i[e]=n};var i=t.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},l=t.cache={};t.render=function(e,n){return h(e)(n)};var r=t.renderFile=function(e,n){var a=t.get(e)||m({filename:e,name:"Render Error",message:"Template not found"});return n?a(n):a};t.get=function(e){var n;if(l[e])n=l[e];else if("object"==typeof document){var a=document.getElementById(e);if(a){var t=(a.value||a.innerHTML).replace(/^\s*|\s*$/g,"");n=h(t,{filename:e})}}return n};var s=function(e,n){return"string"!=typeof e&&(n=typeof e,"number"===n?e+="":e="function"===n?s(e.call(e)):""),e},o={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},c=function(e){return o[e]},u=function(e){return s(e).replace(/&(?![\w#]+;)|[<>"']/g,c)},d=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},f=function(e,n){var a,t;if(d(e))for(a=0,t=e.length;a<t;a++)n.call(e,e[a],a,e);else for(a in e)n.call(e,e[a],a)},p=t.utils={$helpers:{},$include:r,$string:s,$escape:u,$each:f};t.helper=function(e,n){v[e]=n};var v=t.helpers=p.$helpers;t.onerror=function(e){var n="Template Error\n\n";for(var a in e)n+="<"+a+">\n"+e[a]+"\n\n";"object"==typeof console&&console.error(n)};var m=function(e){return t.onerror(e),function(){return"{Template Error}"}},h=t.compile=function(e,n){function t(a){try{return new o(a,s)+""}catch(t){return n.debug?m(t)():(n.debug=!0,h(e,n)(a))}}n=n||{};for(var r in i)void 0===n[r]&&(n[r]=i[r]);var s=n.filename;try{var o=a(e,n)}catch(e){return e.filename=s||"anonymous",e.name="Syntax Error",m(e)}return t.prototype=o.prototype,t.toString=function(){return o.toString()},s&&n.cache&&(l[s]=t),t},y=p.$each,g="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",$=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,w=/[^\w$]+/g,b=new RegExp(["\\b"+g.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),I=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,z=/^$|,+/;i.openTag="{{",i.closeTag="}}";var A=function(e,n){var a=n.split(":"),t=a.shift(),i=a.join(":")||"";return i&&(i=", "+i),"$helpers."+t+"("+e+i+")"};i.parser=function(e,n){e=e.replace(/^\s/,"");var a=e.split(" "),i=a.shift(),l=a.join(" ");switch(i){case"if":e="if("+l+"){";break;case"else":a="if"===a.shift()?" if("+a.join(" ")+")":"",e="}else"+a+"{";break;case"/if":e="}";break;case"each":var r=a[0]||"$data",s=a[1]||"as",o=a[2]||"$value",c=a[3]||"$index",u=o+","+c;"as"!==s&&(r="[]"),e="$each("+r+",function("+u+"){";break;case"/each":e="});";break;case"echo":e="print("+l+");";break;case"print":case"include":e=i+"("+a.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(l)){var d=!0;0===e.indexOf("#")&&(e=e.substr(1),d=!1);for(var f=0,p=e.split("|"),v=p.length,m=p[f++];f<v;f++)m=A(m,p[f]);e=(d?"=":"=#")+m}else e=t.helpers[i]?"=#"+i+"("+a.join(",")+");":"="+e}return e};var _={Question:"question",StemsWrapper:"stemsWrapper",ChildQSAnalyze:"childQSAnalyzeWrapper",AnalyzeWrapper:"analyzeWrapper",Index:"questionIndex",Source:"questionSource",Difficulty:"questionDifficulty",Content:"questionContent",Options:"questionOptions",ChildList:"questionChildList",Answer:"questionAnswer",AnswerItem:"questionAnswerItem",Analyze:"questionAnalyze",AnalyzeItem:"questionAnalyzeItem",KnowledgePoint:"questionKnowledgePoint",KnowledgePointItem:"questionKnowledgePointItem",QueID:"questionID"},S={};S[_.Question]=[_.StemsWrapper,_.AnalyzeWrapper],S[_.StemsWrapper]=[_.Index,_.Source,_.Difficulty,_.Content,_.Options,_.ChildList,_.ChildQSAnalyze],S[_.AnalyzeWrapper]=[_.Answer,_.Analyze,_.KnowledgePoint,_.QueID],S[_.ChildQSAnalyze]=[_.Answer,_.Analyze,_.KnowledgePoint,_.QueID];var L={answer:"答案",analyze:"解析",queId:"ID",knowledgePoint:"知识点",label:"标签"},q="talqs",C=q+"_options",W={main:q,options:C,stems:q+"_main",subqs:q+"_subqs",content:q+"_content",difficulty:q+"_difficulty",index:q+"_index",source:q+"_source",knowledgePoint:q+"_knowledgePoint",id:q+"_id",analyzeItem:q+"_analyze_item",analyzeItemIndex:q+"_analyze_item_index",panelItem:q+"_panel_item",panelItemContent:q+"_panel_item_content",answer:q+"_answer",analyze:q+"_analyze",analyzeGroup:q+"_analyzeGroup",analyzeSingle:q+"analyzeSingle",optionsList:C+"_list",optionsRows:C+"_rows",optionsColumns:C+"_columns",optionsItem:C+"_columns_item",optionsIndex:C+"_index",optionsLabel:C+"_label",optionsContent:C+"_content",label:q+"_label",panel:q+"_panel",tree:q+"_tree",clear:"clearfix"},k={analyzeVersion:0,hideSource:!1,hideDifficulty:!1,templates:S,labels:L,queIndex:0,entryTemplate:_.Question,autoLayoutHook:'[data-auto-layout="1"]',layoutClassName:W.optionsList,components:_},j={};j.json=function(e){return JSON.stringify(e)},j.formatDifficulty=function(e,n){e=parseInt(e,10)||0;for(var a="",t=0;t<e;t++)a+=n;return a},j.formatAnswer=function(e){var n="";if(Array.isArray(e))for(var a=e.length,t=0;t<a;t++)t%5==0&&t>0&&(n+=" "),n+=e[t];return n};var O,P='<div class="'+W.main+'" data-talqs-root="{{data.queId}}">\n  {{ each config.templates[\''+_.Question+"'] }}\n    {{include $value}}\n  {{/each}}\n</div>\n",Q='\n<div class="'+W.stems+" "+W.clear+"\">\n {{each config.templates['"+_.StemsWrapper+"']}}\n    {{include $value}}\n {{/each}}\n</div>\n",T='\n  {{if config.analyzeVersion === 2}}\n     <div class="'+W.analyzeGroup+"\">\n      {{ each config.templates['"+_.AnalyzeWrapper+"'] }}\n        {{include $value}}\n      {{/each}}\n    </div>\n  {{/if}}\n",D='\n{{if index && index > 0}}\n  <span class="'+W.index+'">\n    {{index}}\n  </span>\n{{/if}}\n',K='\n{{if !isSub && !config.hideSource}}\n  <div class="'+W.source+'">\n    {{data.queSource}}\n  </div>\n{{/if}}\n',E='\n{{if data.content && !data.hideContent}}\n  <div class="'+W.content+" "+W.clear+'">{{#data.content}}</div>\n{{/if}}\n',N='\n{{ if data.answerOptionList && data.answerOptionList.length }}\n  <div class="'+W.options+'">\n    <ul class="'+W.optionsList+'" data-auto-layout="{{data.answerOptionList[0].length}}">\n      {{each data.answerOptionList}}\n        <li class="'+W.optionsRows+'">\n          {{if data.isCloze}}\n            <span class="'+W.optionsIndex+'">{{$index+1}}. </span>\n          {{/if}}\n          <ul class="'+W.optionsColumns+"_{{$value.length}} "+W.clear+'">\n            {{each $value}}\n              <li class="'+W.optionsItem+" "+W.clear+'">\n                <span class="'+W.optionsLabel+'">{{$value.aoVal}}. </span>\n                <div class="'+W.optionsContent+'">{{#$value.content}}</div>\n              </li>\n            {{/each}}\n          </ul>\n        </li>\n      {{/each}}\n    </ul>\n  </div>\n{{/if}}\n',R="<span>&#9733;</span>",H='\n{{if !isSub && !config.hideDifficulty}}\n  <div class="'+W.difficulty+"\">\n    {{#data.difficulty | formatDifficulty:'"+R+"'}}\n  </div>\n{{/if}}\n",M="{data:$value,config:config,index:$index+1,isSub:true}",V='\n{{ if data.childList }}\n  <div class="'+W.subqs+"\">\n    {{each data.childList}}\n      {{include '"+_.StemsWrapper+"' "+M+" ''}}\n    {{/each}}\n  </div>\n{{/if}}\n",G='\n{{if isSub && config.analyzeVersion === 1 && !data.childList }}\n   <div class="'+W.analyzeSingle+"\">\n    {{ each config.templates['"+_.ChildQSAnalyze+"'] }}\n      {{include $value}}\n    {{/each}}\n  </div>\n{{/if}}\n",F='\n<div class="'+W.answer+"  "+W.clear+'">\n  <label class="'+W.label+'">\n    {{config.labels.answer}}\n  </label>\n  <div class="'+W.panel+"\">\n    {{include '"+_.AnswerItem+"'}}\n  </div>\n</div>\n",B='\n{{if data.childList}}\n  {{each data.childList}}\n    <div class="'+W.analyzeItem+'">\n      <div class="'+W.analyzeItemIndex+"\">{{$index+1}}</div>\n      {{include '"+_.AnswerItem+"' {data:$value} ''}}\n    </div>\n  {{/each}}\n{{else}}\n  <div class=\""+W.panelItem+'">\n    <div class="'+W.panelItemContent+"\">\n        {{if data.isCloze}}\n          {{data.answer | formatAnswer}}\n        {{else}}\n          {{#data.answer.join(' ')}}\n        {{/if}}\n    </div>\n  </div>\n{{/if}}\n",J='\n<div class="'+W.analyze+"  "+W.clear+'">\n  <label class="'+W.label+'">\n    {{config.labels.analyze}}\n  </label>\n  <div class="'+W.panel+"\">\n    {{include '"+_.AnalyzeItem+"'}}\n  </div>\n</div>\n",U='\n{{if data.childList}}\n  {{each data.childList}}\n    <div class="'+W.analyzeItem+'">\n      <div class="'+W.analyzeItemIndex+"\">{{$index+1}}</div>\n      {{include '"+_.AnalyzeItem+"' {data:$value} ''}}\n    </div>\n  {{/each}}\n{{else}}\n  <div class=\""+W.panelItem+'">\n    <div class="'+W.panelItemContent+'">{{#data.analysis}}</div>\n  </div>\n{{/if}}\n',X='\n <div class="'+W.knowledgePoint+"  "+W.clear+'">\n  <label class="'+W.label+'">\n    {{config.labels.knowledgePoint}}\n  </label>\n  <div class="'+W.tree+"\">\n    <ul>\n      {{each data.examOptionList}}\n        {{include '"+_.KnowledgePointItem+"' {data:$value} ''}}\n      {{/each}}\n    </ul>\n  </div>\n</div>\n",Y="\n<li>\n  {{data.name}}\n  {{if data.childList}}\n    <ul>\n      {{each data.childList}}\n        {{include '"+_.KnowledgePointItem+"' {data:$value} ''}}\n      {{/each}}\n    </ul>\n  {{/if}}\n</li>\n",Z='\n<div class="'+W.id+"  "+W.clear+'">\n  <label class="'+W.label+'">\n    {{config.labels.queId}}\n  </label>\n  <div class="'+W.panel+'">\n    {{data.queId}}  \n  </div>\n</div>\n',ee=(O={},O[_.Question]=P,O[_.StemsWrapper]=Q,O[_.AnalyzeWrapper]=T,O[_.ChildQSAnalyze]=G,O[_.Index]=D,O[_.Source]=K,O[_.Content]=E,O[_.Options]=N,O[_.Difficulty]=H,O[_.ChildList]=V,O[_.Answer]=F,O[_.AnswerItem]=B,O[_.Analyze]=J,O[_.AnalyzeItem]=U,O[_.KnowledgePoint]=X,O[_.KnowledgePointItem]=Y,O[_.QueID]=Z,O),ne={version:"1.0.0",config:k,get components(){return this.config.components}};ne.render=function(e,n){if(e){n=n||{};for(var a in k)void 0===n[a]&&(n[a]=k[a]);ne.config=n;var i=t.cache[n.entryTemplate],l=i({config:n,data:e,index:n.queIndex});return l}};var ae=function(e,n){t.helper(e,n)};ne.registerHelper=ae;for(var te in j)ae(te,j[te]);var ie=function(e){for(var n in e){var a=e[n].replace(/^\s*|\s*$/g,""),i=t.compile(a,{filename:n});t.cache[n]=i}};ie(ee);var le=function(e){var n=ne.config.templates,a=function(a){var t=e[a],i=n[a]||[];if(t.exclude&&t.exclude.length&&i.length&&(i=i.filter(function(e){return t.exclude.indexOf(e)===-1})),t.components&&t.components.length){var l=void 0,r=void 0,s={};t.components.forEach(function(e){if(l=e.name,r=i.indexOf(l),r<0){var n=isNaN(e.index)?i.length:e.index;i.splice(n,0,l)}else isNaN(e.index)||(i.splice(r,1),i.splice(e.index,0,l));s[l]=e.template}),ie(s)}ne.config.templates[a]=i.filter(function(e){return"string"==typeof e})};for(var t in e)a(t)};return ne.updateTemplateList=le,ne.autoLayout=function(e){var n=ne.config.autoLayoutHook,a=document.querySelectorAll(n);a&&a.length&&(a=Array.prototype.slice.apply(a),a.forEach(function(n){var a=e||Math.floor(n.offsetWidth);n.style.display="inline-block";var t=n.children.length,i=Math.ceil(n.offsetWidth+10),l=1;if(i){var r=Math.floor(a/i);l=t<=r?t:i>=a/2?1:i>=a/4?2:4}n.classList.add(ne.config.layoutClassName+"_"+l),n.style.display=""}))},ne});